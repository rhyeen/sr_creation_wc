<dom-module id="sr-add-page-view">
  <template>
    <style include="shared-styles">
      .top-padded {
        margin-top: 20px;
      }
    </style>
    <paper-card>
      <div class="card-content">
        <paper-radio-group selected="{{creationAction}}">
          <paper-radio-button name="link">Bind to an existing page</paper-radio-button>
          <paper-radio-button name="new">Create a new page</paper-radio-button>
        </paper-radio-group>
      </div>
    </paper-card>
    <template is="dom-if" if="[[shouldCreateNewPage(creationAction)]]">
      <paper-card>
        <app-toolbar>
          <div main-title>Create a new page</div>
        </app-toolbar>
        <div class="card-content">
          <paper-dropdown-menu label="Page Type">
            <paper-listbox slot="dropdown-content" class="dropdown-content">
              <template is="dom-repeat" items="{{pageTypes}}">
                <paper-item>{{item}}</paper-item>
              </template>
            </paper-listbox>
          </paper-dropdown-menu>
          <paper-input
              label="Title"
              required></paper-input>
          <paper-textarea label="Summary"></paper-textarea>
        </div>
        <div class="card-actions">
          <paper-toggle-button
              class="top-padded"
              checked="{{linkToPreviousPage}}">Link to previous page</paper-toggle-button>
          <paper-autocomplete
              id="linkedPageInput"
              label="Linked Page"
              source="[[linkedPageSources]]"
              required
              text="{{linkedPageText}}"
              value="{{linkedPageValue}}"
              disabled="[[linkToPreviousPage]]"
              show-results-on-focus></paper-autocomplete>
        </div>
      </paper-card>
    </template>
    <template is="dom-if" if="[[!shouldCreateNewPage(creationAction)]]">
      <paper-card>
        <app-toolbar>
          <div main-title>Bind to an existing page</div>
        </app-toolbar>
        <div class="card-content">
          <paper-autocomplete
              id="titleInput"
              label="Title"
              source="[[titleSearches]]"
              required
              show-results-on-focus></paper-autocomplete>
        </div>
      </paper-card>
    </template>
  </template>

  <script>
    class SrAddPageView extends Polymer.Element {
      static get is() { return 'sr-add-page-view'; }

      static get properties() {
        return {
          titleSearches: {
            type: Array,
            value: []
          },
          linkedPageSources: {
            type: Array,
            value: []
          },
          linkToPreviousPage: {
            type: Boolean,
            value: true
          },
          linkedPageText: {
            type: String,
            value: null
          },
          linkedPageValue: {
            type: String,
            value: null
          },
          pageTypes: {
            type: Array,
            value: []
          },
          creationAction: {
            type: String,
            value: 'link'
          }
        };
      }

      static get observers() {
        return [
          '_linkToPreviousPageChanged(linkToPreviousPage)'
        ];
      }

      shouldCreateNewPage(creationAction) {
        return creationAction == 'new';
      }

      constructor() {
        super();
        this._setLinkedPageDefaults();
        this._setPageTypes();
        // this.$.titleInput.queryFn = this._newQueryFn;
        var newSearch = this._newQueryFn();
        this.set('titleSearches', newSearch);
      }

      _linkToPreviousPageChanged(linkToPreviousPage) {
        if (linkToPreviousPage) {
          this._setLinkedPageDefaults();
        }
      }

      _setLinkedPageDefaults() {
        this.set('linkedPageText', this.page.name);
        this.set('linkedPageValue', this.page.id);
      }

      _setPageTypes() {
        this.set('pageTypes', [
          'Association',
          'Campaign',
          'Character',
          'District',
          'Era',
          'Event',
          'Group',
          'History',
          'Item',
          'Landmark',
          'Lore',
          'Place',
          'Quest',
          'Race',
          'Region',
          'Report',
          'Section',
          'Set',
          'Species',
          'Story arc',
          'Taxon',
          'World',
        ]);
      }

      _newQueryFn() {
        return [
        {"text": "Alabama", "value": "AL"},
        {"text": "Alaska", "value": "AK"},
        {"text": "American Samoa", "value": "AS"},
        {"text": "Arizona", "value": "AZ"},
        {"text": "Arkansas", "value": "AR"},
        {"text": "California", "value": "CA"},
        {"text": "Colorado", "value": "CO"},
        {"text": "Connecticut", "value": "CT"},
        {"text": "Delaware", "value": "DE"},
        {"text": "District Of Columbia", "value": "DC"},
        {"text": "Federated States Of Micronesia", "value": "FM"},
        {"text": "Florida", "value": "FL"},
        {"text": "Georgia", "value": "GA"},
        {"text": "Guam", "value": "GU"},
        {"text": "Hawaii", "value": "HI"},
        {"text": "Idaho", "value": "ID"},
        {"text": "Illinois", "value": "IL"},
        {"text": "Indiana", "value": "IN"},
        {"text": "Iowa", "value": "IA"},
        {"text": "Kansas", "value": "KS"},
        {"text": "Kentucky", "value": "KY"},
        {"text": "Louisiana", "value": "LA"},
        {"text": "Maine", "value": "ME"},
        {"text": "Marshall Islands", "value": "MH"},
        {"text": "Maryland", "value": "MD"},
        {"text": "Massachusetts", "value": "MA"},
        {"text": "Michigan", "value": "MI"},
        {"text": "Minnesota", "value": "MN"},
        {"text": "Mississippi", "value": "MS"},
        {"text": "Missouri", "value": "MO"},
        {"text": "Montana", "value": "MT"},
        {"text": "Nebraska", "value": "NE"},
        {"text": "Nevada", "value": "NV"},
        {"text": "New Hampshire", "value": "NH"},
        {"text": "New Jersey", "value": "NJ"},
        {"text": "New Mexico", "value": "NM"},
        {"text": "New York", "value": "NY"},
        {"text": "North Carolina", "value": "NC"},
        {"text": "North Dakota", "value": "ND"},
        {"text": "Northern Mariana Islands", "value": "MP"},
        {"text": "Ohio", "value": "OH"},
        {"text": "Oklahoma", "value": "OK"},
        {"text": "Oregon", "value": "OR"},
        {"text": "Palau", "value": "PW"},
        {"text": "Pennsylvania", "value": "PA"},
        {"text": "Puerto Rico", "value": "PR"},
        {"text": "Rhode Island", "value": "RI"},
        {"text": "South Carolina", "value": "SC"},
        {"text": "South Dakota", "value": "SD"},
        {"text": "Tennessee", "value": "TN"},
        {"text": "Texas", "value": "TX"},
        {"text": "Utah", "value": "UT"},
        {"text": "Vermont", "value": "VT"},
        {"text": "Virgin Islands", "value": "VI"},
        {"text": "Virginia", "value": "VA"},
        {"text": "Washington", "value": "WA"},
        {"text": "West Virginia", "value": "WV"},
        {"text": "Wisconsin", "value": "WI"},
        {"text": "Wyoming", "value": "WY"}
      ];
      }
    }

    window.customElements.define(SrAddPageView.is, SrAddPageView);
  </script>
</dom-module>
