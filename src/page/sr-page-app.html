<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-badge/paper-badge.html">
<link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../../bower_components/paper-item/paper-icon-item.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">


<link rel="import" href="../page/sr-summary-view.html">
<link rel="import" href="../page/sr-related-pages-view.html">

<link rel="import" href="../shared-styles.html">
<link rel="import" href="../tools/sr-icons.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../material-styles/color.html">
<link rel="import" href="../material-styles/typography.html">
<link rel="import" href="../material-styles/default-theme.html">

<dom-module id="sr-page-app">
  <template>
    <style include="shared-styles iron-flex iron-flex-alignment">
      :host {
        /*display: flex;
        align-items: center;
        justify-content: center;*/
      }
    </style>
    <app-route
        route="[[route]]"
        pattern="/:pageId"
        data="{{routeData}}"></app-route>

    <sr-summary-view page="{{page}}"></sr-summary-view>
    <sr-related-pages-view page="{{page}}"></sr-related-pages-view>
    <iron-ajax
        auto
        url="http://localhost:4000/user/page"
        params="{{getPageParams}}"
        handle-as="json"
        on-response="handleGetPage"
        debounce-duration="300"></iron-ajax>
  </template>

  <script>
    class SrPageApp extends Polymer.Element {
      static get is() { return 'sr-page-app'; }

      static get properties() {
        return {
          page: {
            notify: true,
            readOnly: false,
          },
          routeData: Object,
          pageId: String,
          getPageParams: {
            type: Object,
            value: {}
          }
        };
      }

      static get observers() {
        return [
          '_routeDataChanged(routeData.pageId)',
        ];
      }

      handleGetPage(event) {
        this.setPage(event.detail.response);
      }

      setPage(page) {
        this.page = page;
        console.log(page);
      }

      _routeDataChanged(pageId) {
        if (pageId != this.pageId) {
          this.pageId = pageId;
          this._setGetPageParams(pageId);
        }
      }

      _setGetPageParams(pageId) {
        var getPageParams = {};
        if (pageId) {
          getPageParams.id = pageId; // CA_2MLJEe0YuQrLt
        }
        this.set('getPageParams', getPageParams);
      }
    }

    window.customElements.define(SrPageApp.is, SrPageApp);
  </script>
</dom-module>
