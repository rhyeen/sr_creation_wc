<link rel="import" href="../../bower_components/polymer/polymer-element.html">

<link rel="import" href="../page/sr-image.html">
<link rel="import" href="../page/sr-detail.html">

<link rel="import" href="../shared-styles.html">

<dom-module id="sr-page-relation-view">
  <template>
    <style include="shared-styles">
      .related-pages {
        margin-top: 20px;
      }
    </style>
    <app-route
        route="{{route}}"
        pattern="/:context"
        data="{{routeData}}"></app-route>
    <template is="dom-if" if="contextGroup">
      <template is="dom-repeat" items="{{contextGroup.list}}">
        <sr-image context-item="[[item]]" context-index="[[index]]" route="[[route]]"></sr-image>
        <sr-detail context-item="[[item]]" context-index="[[index]]" route="[[route]]"></sr-detail>
      </template>
    </template>
  </template>
  <script>
    class SrPageRelationView extends Polymer.Element {
      static get is() { return 'sr-page-relation-view'; }

      static get properties() {
        return {
          contextGroup: {
            type: Object
          },
          context: String
        };
      }

      static get observers() {
        return [
          '_routeChanged(route.path)',
          '_routeDataChanged(routeData.context)',
        ];
      }

      _routeChanged(path) {
        // if back button is pressed, and routeData.context is going to be null, it won't be: instead it'll stay the same.
        if (!path) {
          this._routeDataChanged(null);
        }
      }

      _routeDataChanged(context) {
        this.set('context', context);
        this._updateContextedItem(context);
        // this.set('showView', !context || context == 'summary');
      }

      _updateContextedItem(context) {
        if (context == 'detail') {
          return this._updateItemToDetails();
        }
        if (context == 'image') {
          return this._updateItemToImages();
        }
        return this._usetItem();
      }

      _updateItemToDetails() {
        this.set('contextGroup', this.page.details);
      }

      _updateItemToImages() {
        this.set('contextGroup', this.page.images);
      }

      _usetItem() {
        this.set('contextGroup', null);
      }
    }

    window.customElements.define(SrPageRelationView.is, SrPageRelationView);
  </script>
</dom-module>
