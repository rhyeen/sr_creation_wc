<link rel="import" href="../../bower_components/polymer/polymer-element.html">

<link rel="import" href="../page/sr-image.html">
<link rel="import" href="../page/sr-detail.html">

<link rel="import" href="../shared-styles.html">

<dom-module id="sr-page-relation-view">
  <template>
    <style include="shared-styles">
      .related-pages {
        margin-top: 20px;
      }
    </style>
    <app-route
        route="{{route}}"
        pattern="/:context"
        data="{{routeData}}"></app-route>
    <template is="dom-if" if="contextGroup">
      <template is="dom-repeat" items="{{contextGroup.list}}">
        <sr-image context-item="[[item]]" context-index="[[index]]" route="[[route]]"></sr-image>
        <sr-detail context-item="[[item]]" context-index="[[index]]" route="[[route]]"></sr-detail>
      </template>
    </template>
  </template>
  <script>
    class SrPageRelationView extends Polymer.Element {
      static get is() { return 'sr-page-relation-view'; }

      static get properties() {
        return {
          contextGroup: {
            type: Object
          }
        };
      }

      static get observers() {
        return [
          '_routeDataChanged(routeData)',
        ];
      }

      _routeDataChanged(routeData) {
        var context = routeData.context;
        this._updateContextedItem(context);
      }

      _updateContextedItem(context) {
        if (context == 'detail') {
          return this._updateItemToDetails();
        }
        if (context == 'image') {
          return this._updateItemToImages();
        }
        return this._usetItem();
      }

      _updateItemToDetails() {
        this.set('contextGroup', this.page.details);
      }

      _updateItemToImages() {
        this.set('contextGroup', this.page.images);
      }

      _usetItem() {
        this.set('contextGroup', null);
      }
    }

    window.customElements.define(SrPageRelationView.is, SrPageRelationView);
  </script>
</dom-module>
